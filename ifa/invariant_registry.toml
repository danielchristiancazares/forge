version = 1
last_updated = "2026-02-20"

[[invariants]]
id = "APP-INV-1"
predicate = "Exactly one operation lifecycle state exists at a time."
canonical_proof_type_path = "engine::state::OperationState"
authority_boundary_module_path = "engine::app::mod"

[[invariants]]
id = "APP-INV-2"
predicate = "Tool execution is allowed only when tool gate state permits execution."
canonical_proof_type_path = "engine::app::tool_gate::ToolGate"
authority_boundary_module_path = "engine::app::tool_gate"

[[invariants]]
id = "APP-INV-3"
predicate = "Tool loop ingress carries explicit tool journal batch presence via sum type."
canonical_proof_type_path = "engine::state::ToolJournalBatch"
authority_boundary_module_path = "engine::state"

[[invariants]]
id = "APP-INV-4"
predicate = "Tool loop payload carries canonical thinking shape without optional payload fields."
canonical_proof_type_path = "core::thinking::ThinkingPayload"
authority_boundary_module_path = "core::thinking"

[[invariants]]
id = "APP-INV-5"
predicate = "Active stream typestate transitions from transient to journaled only through consuming transition."
canonical_proof_type_path = "engine::state::ActiveStream"
authority_boundary_module_path = "engine::state"

[[invariants]]
id = "APP-INV-6"
predicate = "User-facing message content is non-empty after normalization."
canonical_proof_type_path = "types::proofs::NonEmptyString"
authority_boundary_module_path = "types::proofs"

[[invariants]]
id = "APP-INV-7"
predicate = "Persisted content contains no standalone carriage returns."
canonical_proof_type_path = "types::proofs::PersistableContent"
authority_boundary_module_path = "types::proofs"

[[invariants]]
id = "APP-INV-8"
predicate = "Stream and tool journal crash-recovery identities are explicit typed IDs."
canonical_proof_type_path = "types::ToolBatchId"
authority_boundary_module_path = "context::tool_journal"

[[invariants]]
id = "APP-INV-10"
predicate = "Provider request/response model name selection is represented by strongly typed model names."
canonical_proof_type_path = "types::model::ModelName"
authority_boundary_module_path = "types::model"

[[invariants]]
id = "APP-INV-11"
predicate = "A plan is a valid DAG with non-empty phases and valid monotonically assigned step IDs."
canonical_proof_type_path = "types::plan::Plan"
authority_boundary_module_path = "types::plan"

[[invariants]]
id = "APP-INV-12"
predicate = "A plan has reached a terminal satisfied state across all phases and steps."
canonical_proof_type_path = "types::plan::CompletedPlan"
authority_boundary_module_path = "types::plan"

[[invariants]]
id = "APP-INV-13"
predicate = "Provider SSE payload decode outcome is explicit and never encoded as optional absence."
canonical_proof_type_path = "providers::ParsedSsePayload"
authority_boundary_module_path = "providers"

[[invariants]]
id = "APP-INV-14"
predicate = "Settings modal filter interaction lifecycle is represented as an explicit mode enum."
canonical_proof_type_path = "types::ui::input::SettingsFilterMode"
authority_boundary_module_path = "engine::app::mod"

[[invariants]]
id = "APP-INV-15"
predicate = "Transcript redraw behavior is represented as explicit render action state."
canonical_proof_type_path = "types::ui::view_state::TranscriptRenderAction"
authority_boundary_module_path = "engine::app::commands"

[[invariants]]
id = "APP-INV-16"
predicate = "File picker index readiness is encoded as explicit scan-state lifecycle."
canonical_proof_type_path = "engine::ui::file_picker::FileScanState"
authority_boundary_module_path = "engine::ui::file_picker"

[[invariants]]
id = "APP-INV-17"
predicate = "API token accounting presence is represented by explicit usage-state enum, not derived boolean probes."
canonical_proof_type_path = "types::ApiUsagePresence"
authority_boundary_module_path = "types"

[[invariants]]
id = "APP-INV-18"
predicate = "Tool visibility is represented as explicit exposure state, not hidden boolean flags."
canonical_proof_type_path = "types::ToolVisibility"
authority_boundary_module_path = "types"

[[invariants]]
id = "APP-INV-19"
predicate = "Tool provider applicability is represented by explicit provider scope, not optional provider selectors."
canonical_proof_type_path = "types::ToolProviderScope"
authority_boundary_module_path = "types"

[[invariants]]
id = "APP-INV-20"
predicate = "Tool approval requirement is represented by explicit policy state."
canonical_proof_type_path = "tools::ToolApprovalRequirement"
authority_boundary_module_path = "tools"

[[invariants]]
id = "APP-INV-21"
predicate = "Tool effect behavior is represented by explicit effect-profile variants."
canonical_proof_type_path = "tools::ToolEffectProfile"
authority_boundary_module_path = "tools"

[[invariants]]
id = "APP-INV-22"
predicate = "Tool context librarian capability is represented as explicit enabled/disabled state."
canonical_proof_type_path = "tools::ToolCtxLibrarian"
authority_boundary_module_path = "tools"

[[invariants]]
id = "APP-INV-23"
predicate = "WebFetch cache behavior is represented by explicit cache preference states."
canonical_proof_type_path = "tools::webfetch::types::CachePreference"
authority_boundary_module_path = "tools::webfetch::types"

[[invariants]]
id = "APP-INV-24"
predicate = "WebFetch output completeness is represented by a single sum type carrying truncation cause."
canonical_proof_type_path = "tools::webfetch::types::OutputCompleteness"
authority_boundary_module_path = "tools::webfetch::types"

[[invariants]]
id = "APP-INV-25"
predicate = "WebFetch retry semantics are represented by explicit retryability state."
canonical_proof_type_path = "tools::webfetch::types::Retryability"
authority_boundary_module_path = "tools::webfetch::types"

[[invariants]]
id = "APP-INV-26"
predicate = "UI rendering options are represented by explicit view-state enums, not toggling booleans."
canonical_proof_type_path = "types::ui::view_state::AsciiOnly"
authority_boundary_module_path = "types::ui::view_state"

[[invariants]]
id = "APP-INV-27"
predicate = "Settings detail presentation is represented as explicit hidden/visible detail view state."
canonical_proof_type_path = "types::ui::input::DetailView"
authority_boundary_module_path = "types::ui::input"

[[invariants]]
id = "APP-INV-28"
predicate = "Atomic write file durability behavior is represented by explicit file sync policy."
canonical_proof_type_path = "utils::atomic_write::FileSyncPolicy"
authority_boundary_module_path = "utils::atomic_write"

[[invariants]]
id = "APP-INV-29"
predicate = "Atomic write directory durability behavior is represented by explicit parent directory sync policy."
canonical_proof_type_path = "utils::atomic_write::ParentDirSyncPolicy"
authority_boundary_module_path = "utils::atomic_write"

[[invariants]]
id = "APP-INV-30"
predicate = "Run sandbox activation is represented as explicit enabled/disabled mode."
canonical_proof_type_path = "tools::RunSandboxMode"
authority_boundary_module_path = "tools"

[[invariants]]
id = "APP-INV-31"
predicate = "Run shell restrictions are represented by explicit shell-constraint states."
canonical_proof_type_path = "tools::ShellConstraint"
authority_boundary_module_path = "tools"

[[invariants]]
id = "APP-INV-32"
predicate = "Run network control is represented by explicit network policy state."
canonical_proof_type_path = "tools::NetworkPolicy"
authority_boundary_module_path = "tools"
